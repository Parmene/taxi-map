<!DOCTYPE html>
<html>
<head>
    <title>햏햟쒫쟳햟혝쮐 뉋쮏얧쟴햣햩혪</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { margin: 0; padding: 0; font-family: -apple-system, sans-serif; background: #f3f3f2;}
        #map { height: 100vh; width: 100vw; z-index: 1; }
        .bottom-sheet { position: fixed; bottom: 0; left: 0; right: 0; background: white; border-radius: 20px 20px 0 0; padding: 20px; box-shadow: 0 -4px 20px rgba(0,0,0,0.15); z-index: 1000; }
        .address-box { margin-bottom: 12px; font-size: 16px; font-weight: 500; background: #f5f5f5; padding: 12px; border-radius: 10px;}
        .title { font-size: 12px; color: #888; text-transform: uppercase; margin-bottom: 4px;}
        .main-btn { width: 100%; background: #000; color: white; border: none; padding: 16px; border-radius: 12px; font-weight: bold; font-size: 16px; cursor: pointer; }
        .custom-icon { background: none; border: none; }
        .marker-a { background: #000; color: white; border-radius: 50%; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; font-weight: bold; border: 3px solid white;}
        .marker-b { background: #ffde00; color: black; border-radius: 50%; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; font-weight: bold; border: 3px solid white;}
    </style>
</head>
<body>

<div id="map"></div>

<div class="bottom-sheet" id="sheet">
    <div class="title">游늸 뤰햨혞햢햟 향햟햠햟혝혧:</div>
    <div class="address-box" id="addr-from">행햟햡혞향햨햟...</div>
    <div class="title">游끠 햌혞햢햟 쮐쒫왏혝햦:</div>
    <div class="address-box" id="addr-to">행햟햡혞향햨햟...</div>
    <button class="main-btn" onclick="tg.close()">햐쒫왐햫혞혝혧 햨햟혝혞</button>
</div>

<script>
    const tg = window.Telegram.WebApp; tg.expand(); tg.ready();
    const urlParams = new URLSearchParams(window.location.search);
    const latA = urlParams.get('latA'), lonA = urlParams.get('lonA');
    const latB = urlParams.get('latB'), lonB = urlParams.get('lonB');
    const textFrom = decodeURIComponent(urlParams.get('addrA'));
    const textTo = decodeURIComponent(urlParams.get('addrB'));

    document.getElementById('addr-from').innerText = textFrom;
    document.getElementById('addr-to').innerText = textTo;

    const map = L.map('map', {zoomControl: false}).setView([58.6035, 49.6680], 13);
    L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png', { maxZoom: 19 }).addTo(map);

    if (latA && lonA && latB && lonB) {
        L.marker([latA, lonA], {icon: L.divIcon({className: 'custom-icon', html: '<div class="marker-a">A</div>', iconSize: [30, 30]})}).addTo(map);
        L.marker([latB, lonB], {icon: L.divIcon({className: 'custom-icon', html: '<div class="marker-b">B</div>', iconSize: [30, 30]})}).addTo(map);
        
        fetch(`https://router.project-osrm.org/route/v1/driving/${lonA},${latA};${lonB},${latB}?overview=full&geometries=geojson`)
        .then(res => res.json())
        .then(data => {
            if(data.routes && data.routes.length > 0) {
                let routeLine = L.geoJSON(data.routes[0].geometry, { style: {color: '#007aff', weight: 5, opacity: 0.8} }).addTo(map);
                map.fitBounds(routeLine.getBounds(), {padding: [50, 50]});
            }
        });
    }
</script>
</body>
</html>
